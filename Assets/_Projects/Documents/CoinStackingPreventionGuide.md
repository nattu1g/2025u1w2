# 積み上がり防止のための微調整ガイド

## 問題: コインがまだ積み上がってしまう

以下の段階的な調整方法を試してください。

## 🔧 調整方法（優先度順）

### 1. 摩擦係数を極限まで下げる

**CoinType Inspector設定:**
```
Friction: 0.0 ~ 0.05
```

**効果:** 摩擦がほぼゼロになり、コインが非常に滑りやすくなります。

**調整手順:**
1. Frictionを`0.05`から`0.0`まで段階的に下げる
2. `0.02`程度が最適な場合が多い

---

### 2. コライダーのスケールを小さくする

**CoinType Inspector設定:**
```
Collider Scale: 0.85 ~ 0.95
```

**効果:** コライダーが小さくなることで、接触面積が減り、積み上がりにくくなります。

**調整手順:**
1. `0.95`から`0.85`まで段階的に下げる
2. 見た目とのバランスを確認

---

### 3. 反発係数を上げる

**CoinType Inspector設定:**
```
Bounciness: 0.3 ~ 0.5
```

**効果:** コインが跳ねやすくなり、積み上がる前に弾かれます。

**調整手順:**
1. `0.3`から`0.5`まで段階的に上げる
2. 跳ねすぎる場合は`0.4`程度に調整

---

### 4. 質量を調整する

**CoinType Inspector設定:**
```
Mass: 0.3 ~ 0.7
```

**効果:** 
- 軽すぎる（0.3以下）: 積み上がりやすい
- 重すぎる（1.0以上）: 下のコインを押しつぶして積み上がる
- 最適（0.5前後）: バランスが良い

---

### 5. ランダム初期回転を有効化

**CoinType Inspector設定:**
```
Random Initial Rotation: ✅ チェック
```

**効果:** コインが毎回異なる角度で落下し、同じ場所に積み上がりにくくなります。

---

### 6. CircleCollider2Dを使用

**重要:** BoxCollider2Dを使用している場合、CircleCollider2Dに変更してください。

**理由:**
- 円形コライダーは角がないため、滑りやすい
- 接触点が常に1点になるため、積み上がりにくい

**変更手順:**
1. BoxCollider2Dを削除
2. CircleCollider2Dを追加
3. Radiusをコインのサイズに合わせる（例: `0.5`）

---

## 🎯 推奨設定（積み上がり防止特化）

### 最も滑りやすい設定

```
【物理設定】
Friction: 0.02
Bounciness: 0.4

【積み上がり防止設定】
Collider Scale: 0.90
Random Initial Rotation: ✅

【Rigidbody2D設定】
Mass: 0.5
Linear Drag: 0.3
Angular Drag: 0.3
```

### バランス型設定

```
【物理設定】
Friction: 0.05
Bounciness: 0.3

【積み上がり防止設定】
Collider Scale: 0.95
Random Initial Rotation: ✅

【Rigidbody2D設定】
Mass: 0.5
Linear Drag: 0.5
Angular Drag: 0.5
```

---

## 🔍 追加の対策

### A. コイン生成位置にランダム性を追加

**CoinSpawner.cs の修正案:**

毎回同じ位置に落とすのではなく、少しランダムにずらす。

```csharp
Vector3 spawnPosition = _spawnPoint.position;
spawnPosition.x += Random.Range(-0.2f, 0.2f); // X軸に±0.2のランダム性
```

### B. 初期速度を少し速くする

**CoinSpawner Inspector設定:**
```
Initial Velocity: 2.0 ~ 5.0
```

**効果:** 落下速度が速いと、下のコインに乗る前に滑り落ちやすくなります。

### C. 重力スケールを上げる

**Rigidbody2D設定:**
```
Gravity Scale: 1.5 ~ 2.0
```

**効果:** より速く落下し、積み上がる前に滑り落ちます。

---

## 📊 テスト方法

### 1. 基本テスト
1. 同じ位置に5回連続でコインを投下
2. コインが積み上がらず、すべて滑り落ちることを確認

### 2. 連続投下テスト
1. 0.5秒間隔で10回連続投下
2. 最終的にコインが平らに広がっていることを確認

### 3. 壁際テスト
1. 水槽の壁際にコインを投下
2. 壁に沿って滑り落ちることを確認

---

## ⚠️ トラブルシューティング

### まだ積み上がる場合

**チェックリスト:**
- [ ] CircleCollider2Dを使用しているか？
- [ ] Frictionが`0.05`以下か？
- [ ] Collider Scaleが`0.95`以下か？
- [ ] Random Initial Rotationが有効か？
- [ ] Coin ↔ Coin のレイヤー衝突が有効か？

### コインが滑りすぎる場合

**対策:**
- Frictionを`0.1`程度に上げる
- Linear Dragを`0.7`程度に上げる
- Collider Scaleを`0.98`程度に上げる

### コインが跳ねすぎる場合

**対策:**
- Bouncinessを`0.2`以下に下げる
- Massを`0.7`程度に上げる

---

## 💡 最終手段

上記すべてを試しても積み上がる場合、以下の設定を試してください：

```
Friction: 0.0（完全にゼロ）
Bounciness: 0.5
Collider Scale: 0.85
Mass: 0.4
Gravity Scale: 1.5
```

この設定で、コインは氷の上のように滑り、ほぼ確実に積み上がりません。
