# プロジェクト仕様書：『もうひとつ、沈める？ 〜強欲の水槽〜』

## 1. ゲームコンセプト

「コインを沈めて、水を膨らませろ。」

コインを落とすたびに**水そのものが膨張**していく不思議な水槽。溢れる前に利確するか、リスクを取ってコインを買い足すかの**強欲チキンレース**ゲーム。

## 2. コアゲームメカニクス

### 2.1 コイン投下システム

- プレイヤーは画面上部からコインを水槽に落とす
- コインは物理演算に従って落下し、水オブジェクトと相互作用する

### 2.2 水の膨張メカニクス（コアシステム）

- コインが水オブジェクト（青いCube/Mesh）を通過・接触すると、水が**膨張（Scaleアップ）**する
- コインの種類によって「膨張率」が異なる:
  - **通常コイン**: 安価。通過時の水膨張が大きい
  - **高密度コイン**: 高価。通過しても水がほとんど膨らまない
  - **冷却コイン**: 特別なコイン。通過すると水の体積を一定量**小さくする**効果

### 2.3 ゲームオーバー条件

- 水オブジェクトが膨らみすぎて、水槽の縁から外（下）へこぼれ落ちたら**ゲームオーバー**

### 2.4 フォールド（利確）システム

- 水位が「基準線」を超えていれば、いつでも中断してポイントを獲得できる
- 水位が高いほど、獲得ポイントが増加する
- プレイヤーは「もう1枚沈めるか」「今利確するか」の判断を迫られる

**フォールドボタンの動作仕様:**
1. フォールドボタンを押すと、以下の処理を実行：
   - 全てのWaterオブジェクトを削除
   - 全てのCoinオブジェクトを削除
   - 基準線を上昇させる（次のラウンドの難易度上昇）
   - 獲得ポイントを計算して加算
2. 新しいラウンドを開始
   - 水オブジェクトを初期状態で再生成
   - 基準線が上がった状態でスタート

**ポイント計算システム:**
- **基本ポイント**: 水の膨張1回あたり **10ポイント**
  - 例: 2個のコインが水に触れた場合 = 20ポイント
- **フォールド倍率**: 基準線到達後、フォールド回数に応じて倍率が上昇
  - 0回目（初回）: **1.5倍**
  - 1回目: **2.0倍**
  - 2回目: **2.5倍**
  - 3回目以降: **3.0倍**（最大）
- **計算例**:
  - 初回フォールド、10回膨張: 10 × 10 × 1.5 = **150ポイント**
  - 2回目フォールド、15回膨張: 10 × 15 × 2.5 = **375ポイント**

**基準線の上昇:**
- フォールド回数に応じて基準線の高さが上昇
  - 0回目: Y = 2.0
  - 1回目: Y = 2.5
  - 2回目: Y = 3.0
  - 3回目以降: Y = 3.5（最大）
- 基準線が高いほど、フォールドの難易度が上がる

## 3. ショップシステム

獲得したポイントを使い、以下の特殊コインを購入して戦略的に水位をコントロールする。

### コインの種類と特性

| コイン種類 | 価格 | 水膨張率 | 特殊効果 |
|----------|------|---------|---------|
| 通常コイン | 安価 | 大 | なし |
| 高密度コイン | 高価 | 小 | なし |
| 冷却コイン | 特別価格 | - | 水の体積を減少させる |

## 4. ゲームの葛藤ポイント

プレイヤーは以下の心理的葛藤を体験する:

- 「あともう1枚だけコインを沈めれば、もっと高いポイントでフォールドできる！」
- 「でも、今の水の状態だと、次の1枚で溢れてしまうかもしれない……」
- 「ショップで『体積減少コイン』を買うために、今はリスクを取って回すべきか？」

## 5. 技術的実装仕様

### 5.1 水の膨張ロジック

コインに`CoinType`スクリプトを持たせ、水側の`OnTriggerEnter`で判定:

```csharp
void OnTriggerEnter(Collider other) {
    if (other.CompareTag("Coin")) {
        float rate = other.GetComponent<CoinType>().expansionRate;
        // 水のScaleを大きくする
        transform.localScale += new Vector3(rate, rate, rate);
    }
}
```

### 5.2 水槽とこぼれる判定

- 水槽をCubeの壁で構成
- 水オブジェクトに`Rigidbody`を持たせる（膨らんで壁を超えると自然に物理で落ちる）
- 水槽の下に大きな`Trigger`を配置し、水オブジェクトが触れたら`GameOver`を呼び出す

### 5.3 物理的攻略要素

「どのルートでコインを落とせば水が溢れにくいか」というパチンコのような物理的な攻略要素を含む。

## 6. UI/UX仕様

### 6.1 メイン画面

- 水槽の表示（3D）
- 現在の水位インジケーター
- 基準線の表示
- コイン投下ボタン
- フォールドボタン
- 現在のポイント表示

### 6.2 ショップ画面

- 各種コインの購入UI
- 所持ポイントの表示
- コインごとの効果説明

### 6.3 演出

- 水が膨らむ時のエフェクト
- 溢れる時の絶望的な音
- BGM
- コイン投下時の効果音
